<!DOCTYPE HTML>
<html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge'>
	<meta name='viewport' content='width=device-width, initial-scale=1'>

	<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
	<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
	<link rel='stylesheet' href='https://rawgit.com/hiooyUI/simple-switch/master/simple-switch.min.css'>

	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>
	<script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
	<script src='https://rawgit.com/hiooyUI/simple-switch/master/jquery.simpleswitch.min.js'></script>

	<script>
		jQuery(function($)
		{
			//-- INIT
			fancontrol();
			wunderground();

			//-- EVERY 1min.
			setInterval(function()
			{ 
			    fancontrol();
			}, 60000);
			
			//-- EVERY 5min.
			setInterval(function()
			{ 
			    wunderground();
			}, 300000);

			$('.ios').simpleSwitch();

			$(document).on('click','.ios',function()
			{
				var esp = $(this).data('esp'),
					cmd = $(this).data('cmd'),
					url = 'esp/' + esp +'.php?redirect=' + cmd; 
				
				$.ajax({method:'GET',url:url})
			});

			function fancontrol()
			{	
				//$.getScript("http://192.168.0.200/getdata.js", function()
				$.getScript("esp/fancontrol.php", function()
				{
					//-- SET SYSTEM TEMPERATURE
					$('.fancontrol-systemp').text(fancontroldata.celsius);
					//-- SET FAN STATE
					if (fancontroldata.fanstate == 'on') $('.fancontrol-fanstate').addClass('fa-spin');
					else $('.fancontrol-fanstate').removeClass('fa-spin');

					//-- LOGGER
					if (fancontroldata.logger == 'on') $('.fancontrol-logger').prop('checked', true).parent().removeClass('unchecked').addClass('checked');
					else $('.fancontrol-logger').prop('checked', false).parent().removeClass('checked').addClass('unchecked');					

					//-- MANUAL
					if (fancontroldata.fanCurrentState == 'on') $('.fancontrol-manual').prop('checked', true).parent().removeClass('unchecked').addClass('checked');
					else $('.fancontrol-manual').prop('checked', false).parent().removeClass('checked').addClass('unchecked');

					//-- VACATION
					if (fancontroldata.vacation == 'on') $('.fancontrol-vacation').prop('checked', true).parent().removeClass('unchecked').addClass('checked');
					else $('.fancontrol-vacation').prop('checked', false).parent().removeClass('checked').addClass('unchecked');
				});
				
			}
			
			function wunderground()
			{
				$.getScript("services/wunderground.php", function()
				{
					$('.wunderground-location').text(dataWU.location);
					$('.wunderground-date').text(dataWU.date);
					$('.wunderground-temperature').html(dataWU.temperature + '&#8451;');
					$('.wunderground-humidity').text(dataWU.humidity);
					$('.wunderground-icon').html("<img src='"+dataWU.icon+"' />");
				});				
			}
		});
	</script>
	
	<style>
		.iost{position:relative;top:-6px;}
		.badge { font-size: 14px !important;}
	</style>

	<title>My Home Assistant</title>
</head>
<body>
	<div class='container-fluid'>   
		<div class='row'>     
			<div class='col-md-12'>       
				<h2>MyHome <a href='/smarthome'><button class='btn btn-default btn-lg'><span class='fa fa-refresh' aria-hidden='true'></span></button></a></h2> 
				<!-- Nav tabs -->
				<ul class="nav nav-pills" role="tablist">
					<li role="presentation"><a href="#dashboard" aria-controls="dashboard" role="tab" data-toggle="tab"><i class="fa fa-home" aria-hidden="true"></i></a></li>
					<li role="presentation"><a href="#vetranie" aria-controls="vetranie" role="tab" data-toggle="tab">Vetranie</a></li>
					<li role="presentation"><a href="#wifi" aria-controls="wifi" role="tab" data-toggle="tab">WiFi</a></li>
					<li role="presentation"><a href="#zahrada" aria-controls="zahrada" role="tab" data-toggle="tab">Záhrada</a></li>
				</ul>

				<br />

				<!-- Tab panes -->
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="dashboard">
						<ul class='list-group'>
							<li class='list-group-item'>Stav vetrania <span class='pull-right iost'><span class='fancontrol-fanstate fa fa-cog fa-2x text-inverse'></span></li>
							<li class='list-group-item'>Počasie <span class='wunderground-location'></span> <span class='wunderground-date'></span> <span class='wunderground-icon'></span> <span class="badge wunderground-humidity"></span><span class="badge wunderground-temperature"></span></li>
						</ul>					
					</div>
					
					<div role="tabpanel" class="tab-pane" id="vetranie">
						<ul class='list-group'>
							<li class='list-group-item'>Stav vetrania <span class='pull-right iost'><span class='fancontrol-fanstate fa fa-cog fa-2x text-inverse'></span></li>
							<li class='list-group-item'>Teplota v kúpelni v &#8451; <span class='pull-right'><i class="fa fa-refresh fa-spin" aria-hidden="true"></i> Načítavam&hellip;</span></li>
							<li class='list-group-item'>Vlhkosť v kúpelni v % <span class='pull-right'><i class="fa fa-refresh fa-spin" aria-hidden="true"></i> Načítavam&hellip;</span></li>

							<li class='list-group-item'>Systémová teplota v &#8451;<span class='pull-right fancontrol-systemp'><i class="fa fa-refresh fa-spin" aria-hidden="true"></i> Načítavam&hellip;</span></li>
							<li class='list-group-item'>Logovanie <span class='pull-right iost'><input type='checkbox' class='ios fancontrol-logger' data-esp='fancontrol' data-cmd='logger' unchecked /></span></li>

							<li class='list-group-item'>Manuálne spustenie <span class='pull-right iost'><input type='checkbox' class='ios fancontrol-manual' data-esp='fancontrol' data-cmd='toggle' unchecked /></span></li>
							<li class='list-group-item'>Dovolenkový režim <span class='pull-right iost'><input type='checkbox' class='ios fancontrol-vacation' data-esp='fancontrol' data-cmd='vacation' unchecked /></span></li>
							
							<li class='list-group-item'>Letný režim <span class='pull-right iost'><input type='checkbox' class='ios fancontrol-summer' data-esp='fancontrol' data-cmd='summer' unchecked /></span></li> 
						</ul>
					</div>
					
					<div role="tabpanel" class="tab-pane" id="wifi">...</div>
					<div role="tabpanel" class="tab-pane" id="zahrada">...</div>
				</div>   

			</div>
		</div>
	</div>
</body>
</html>
